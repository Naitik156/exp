<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Syllabus Tracker</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="favicon.png">
    <meta name="theme-color" content="#0F766E">

    <!-- ⚡ STEP 1: Preconnect to all external domains FIRST
         This starts DNS + TCP handshake before browser even parses the rest -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://unpkg.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://www.gstatic.com">

    <!-- ⚡ STEP 2: Load CSS first (render-blocking is OK for CSS — we need it) -->
    <link rel="stylesheet" href="styles.css">

    <!-- ⚡ STEP 3: Fonts with display=swap so text shows immediately in fallback font -->
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC34JnP3u8km7TlX17JcA7Xw5UkddLrfvY",
            authDomain: "my-exam-tracker-80be7.firebaseapp.com",
            projectId: "my-exam-tracker-80be7",
            storageBucket: "my-exam-tracker-80be7.firebasestorage.app",
            messagingSenderId: "507669777779",
            appId: "1:507669777779:web:4df324624b99de359cc906"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.auth = auth;
        window.db = db;
        window.dbFuncs = { doc, getDoc, setDoc, updateDoc };

        window.logoutUser = () => {
            if(confirm("Logout karein?")) {
                const uid = window.auth?.currentUser?.uid;
                localStorage.removeItem('lastView');
                localStorage.removeItem('lastClass');
                localStorage.removeItem('lastSubject');
                localStorage.removeItem('lastChapter');
                localStorage.removeItem('currentExam');
                if (uid) {
                    localStorage.removeItem('localDataTime_' + uid);
                }
                signOut(auth).then(() => {
                    window.location.href = "login.html";
                });
            }
        };
    </script>

    <style>
        /* Splash screen shown while #root is empty */
        #root:empty {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, #ECFDF5 0%, #F0FDFA 50%, #FEF3C7 100%);
        }
        #root:empty::before {
            content: "";
            width: 120px;
            height: 120px;
            background-image: url('favicon.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            margin-bottom: 30px;
            animation: pulseLogo 1.5s infinite ease-in-out;
        }
        #root:empty::after {
            content: "";
            width: 35px;
            height: 35px;
            border: 4px solid rgba(15, 118, 110, 0.1);
            border-left: 4px solid #0F766E;
            border-radius: 50%;
            animation: spinSpinner 1s linear infinite;
        }
        @keyframes spinSpinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes pulseLogo {
            0% { transform: scale(0.9); opacity: 0.7; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(0.9); opacity: 0.7; }
        }
    </style>
</head>
<body>

    <div id="root"></div>

    <!-- ⚡ React from jsdelivr (faster than unpkg) -->
    <script crossorigin src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- ⚡ Chart.js loaded AFTER React so it doesn't block app startup -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js"></script>

    <!-- Your main app -->
    <script src="app.js"></script>

    <!-- ⚡ Service Worker registration — bumped to v5 to force cache refresh -->
    <script>
        if ("serviceWorker" in navigator) {
            // Delay SW registration by 3s so it doesn't compete with page load
            window.addEventListener("load", () => {
                setTimeout(() => {
                    navigator.serviceWorker.register("sw.js?v=5").then(reg => {
                        reg.update();
                    }).catch(err => console.log("SW registration failed:", err));
                }, 3000);
            });
        }
    </script>
</body>
</html>
